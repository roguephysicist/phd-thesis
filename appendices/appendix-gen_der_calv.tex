\section{Generalized derivative \texorpdfstring{$\Big({\cal V}^{\gS,\rma,\ell}_{nm}\Big)_{;k^\rmb}$}{(Vnm);kb}}\label{calvs} 
From Eq.~\eqref{vopii}
\begin{align}\label{a.1}
\left(
\calv^{\gS,\rma,\ell}_{nm}
\right)_{;k^\rmb}
=
\left(
\calv^{\lda,\rma,\ell}_{nm}
\right)_{;k^\rmb}
+
\left(
\calv^{S,\rma,\ell}_{nm}
\right)_{;k^\rmb}
.
\end{align} 
For the LDA term we have
\begin{align}\label{a.2}
\calv^{\lda,\rma,\ell}_{nm}
&=
\frac{1}{2}\left(  
v^{\lda,\rma}\calc^\ell+\calc^\ell v^{\lda,\rma}
\right)_{nm}
\nonumber\\
&=
\frac{1}{2}\sum_q\left(  
v^{\lda,\rma}_{nq}\calc^\ell_{qm}+\calc^\ell_{nq} v^{\lda,\rma}_{qm}
\right)
\nonumber\\
\left(\calv^{\lda,\rma}_{nm}\right)_{;k^\rmb}
&=
\frac{1}{2}\sum_q\left(  
v^{\lda,\rma}_{nq}\calc^\ell_{qm}+\calc^\ell_{nq} p^{\lda,\rma}_{qm}
\right) _{;k^\rmb}
\nonumber\\
&=
\frac{1}{2}\sum_q\left(
(v^{\lda,\rma}_{nq})_{;k^\rmb}\calc^\ell_{qm}
+   
v^{\lda,\rma}_{nq}(\calc^\ell_{qm})_{;k^\rmb}
+
(\calc^\ell_{nq})_{;k^\rmb} v^{\lda,\rma}_{qm}
+
\calc^\ell_{nq} (v^{\lda,\rma}_{qm})_{;k^\rmb}
\right)
,
\end{align}   
where we omitted $\bfk$ in all quantities.
From Eq.~\eqref{cn8} we know that $\bfv^\nl_{nm}(\bfk)$
 can be readily
calculated,
and from Appendix \ref{calpcalc}, both $v^a_{nm}$ and
$\calc_{nm}^\ell$ are also known quantities, 
 and thus the
$\bfv^\lda_{nm}(\bfk)$ are known, which in turns means that 
$\calv^{\lda,\rma,\ell}_{nm}$ are also known.
For the generalized derivative 
$(\bfv^\lda_{nm}(\bfk))_{;\bfk}$ we use Eq.~\eqref{chon.98}
to write
\begin{align}\label{a.3}
(v^{\lda,\rma}_{nm})_{;k^\rmb}
&=  
im_e(\go^\lda_{nm}r^\rma_{nm})_{;k^\rmb}
\nonumber\\
&=  
im_e(\go^\lda_{nm})_{;k^\rmb} r^\rma_{nm}
+  
im_e\go^\lda_{nm}(r^\rma_{nm})_{;k^\rmb}
\nonumber\\
&=  
im_e\gD^b_{nm}r^\rma_{nm}
+ 
im_e\go^\lda_{nm}(r^\rma_{nm})_{;k^\rmb}
\quad\mathrm{for}\quad n\ne m
,
\end{align} 
where we used Eq \eqref{eli.13} and $(r^\rma_{nm})_{;k^\rmb}$ is given
in Eq.~\eqref{na_rgendevn}.

Likewise,
For the S term we have
\begin{align}\label{a.3b}
\calv^{S,\rma,\ell}_{nm}
&=
\frac{1}{2}\left(  
v^{S,\rma}\calc^\ell+\calc^\ell v^{S,\rma}
\right)_{nm}
\nonumber\\
&=
\frac{1}{2}\sum_q\left(  
v^{S,\rma}_{nq}\calc^\ell_{qm}+\calc^\ell_{nq} v^{S,\rma}_{qm}
\right)
\nonumber\\
\left(\calv^{S,\rma}_{nm}\right)_{;k^\rmb}
&=
\frac{1}{2}\sum_q\left(  
v^{S,\rma}_{nq}\calc^\ell_{qm}+\calc^\ell_{nq} p^{S,\rma}_{qm}
\right) _{;k^\rmb}
\nonumber\\
&=
\frac{1}{2}\sum_q\left(
(v^{S,\rma}_{nq})_{;k^\rmb}\calc^\ell_{qm}
+   
v^{S,\rma}_{nq}(\calc^\ell_{qm})_{;k^\rmb}
+
(\calc^\ell_{nq})_{;k^\rmb} v^{S,\rma}_{qm}
+
\calc^\ell_{nq} (v^{S,\rma}_{qm})_{;k^\rmb}
\right)
,
\end{align}   
where $v^{S,\rma}_{nm}(\bfk)$ are given in Eq.~\eqref{chon.2}
and
$(v^{S,\rma}_{nm})_{;k^\rmb}$ is given in Eq. A(6) of
Ref.~\onlinecite{cabellosPRB09},
\begin{align}\label{choni.1}
(v^{S,\rma}_{nm})_{;k^\rmb}=i\gD f_{mn}
(r^\rma_{nm})_{;k^\rmb}
.
\end{align}

To evaluate $(\calc^\ell_{nm})_{;k^\rma}$, we use the fact that as
$\calc^\ell(z)$ is only a function of the $z$ coordinate, its commutator
with $\bfr$ is zero, then,
\begin{align}\label{a.4}
\bra{n\bfk}
\left[r^\rma,\calc^\ell(z)\right]
\ket{m\bfk'}
&=
\bra{n\bfk}
\left[r_e^\rma,\calc^\ell(z)\right]
\ket{m\bfk'}
+
\bra{n\bfk}
\left[r_i^\rma,\calc^\ell(z)\right]
\ket{m\bfk'}
=
 0
.
\end{align} 
The interband part reduces to,
\begin{align}\label{a.5}
\left[r_e^\rma,\calc^\ell(z)\right]_{nm}
&=
\sum_{q\bfk''}
\left(
\bra{n\bfk}
r_e^\rma
\ket{q\bfk''}
\bra{q\bfk''}
\calc^\ell(z)
\ket{m\bfk'}
-
\bra{n\bfk}
\calc^\ell(z)
 \ket{q\bfk''}
\bra{q\bfk''}
r_e^\rma
\ket{m\bfk'}
\right)
\nonumber\\
&=
\sum_{q\bfk''}
\gd(\bfk-\bfk'')
\gd(\bfk'-\bfk'')
\left(
(1-\gd_{qn})
\xi_{nq}^\rma
\calc^\ell_{qm}
-
(1-\gd_{qm})
\calc^\ell_{nq}
\xi_{qm}^\rma
\right)
\nonumber\\
&=
\gd(\bfk-\bfk')
\left(
\sum_{q}
\left(
\xi_{nq}^\rma
\calc^\ell_{qm}
-
\calc^\ell_{nq}
\xi_{qm}^\rma
\right)
+
\calc^\ell_{nm}(\xi_{mm}^\rma-\xi_{nn}^\rma)
\right)
,
\end{align}
where we used Eq.~\eqref{rnme}, and the $\bfk$ and $z$ dependence is implicitly
understood. From Eq.~\eqref{conmri3} the intraband part is,
\begin{align}\label{a.6}
\bra{n\bfk}[\hat\bfr_i,\calc^\ell(z)]\ket{m\bfk'}
=i\gd(\bfk-\bfk')(\calc^\ell_{nm})_{;\bfk}
,
\end{align}
then from Eq.~\eqref{a.4}
\begin{align}\label{a.7}
&
\left(
(\calc^\ell_{nm})_{;\bfk}
-i
\sum_{q}
\left(
\xi_{nq}^\rma
\calc^\ell_{qm}
-
\calc^\ell_{nq}
\xi_{qm}^\rma
\right)
-i
\calc^\ell_{nm}(\xi_{mm}^\rma-\xi_{nn}^\rma)
\right) i\gd(\bfk-\bfk')
=0
\nonumber\\
\frac{1}{i}(\calc^\ell_{nm})_{;\bfk}
&=
\sum_{q}
\left(
\xi_{nq}^\rma
\calc^\ell_{qm}
-
\calc^\ell_{nq}
\xi_{qm}^\rma
\right)
+
\calc^\ell_{nm}(\xi_{mm}^\rma-\xi_{nn}^\rma)
\nonumber\\
&=
\sum_{q\ne nm}
\left(
\xi_{nq}^\rma
\calc^\ell_{qm}
-
\calc^\ell_{nq}
\xi_{qm}^\rma
\right)
+
\left(
\xi_{nn}^\rma
\calc^\ell_{nm}
-
\calc^\ell_{nn}
\xi_{nm}^\rma
\right)_{q=n}
+
\left(
\xi_{nm}^\rma
\calc^\ell_{mm}
-
\calc^\ell_{nm}
\xi_{mm}^\rma
\right)_{q=m}
\nonumber\\
&+
\calc^\ell_{nm}(\xi_{mm}^\rma-\xi_{nn}^\rma)
\nonumber\\
(\calc^\ell_{nm})_{;\bfk}
&=
i\sum_{q\ne nm}
\left(
\xi_{nq}^\rma
\calc^\ell_{qm}
-
\calc^\ell_{nq}
\xi_{qm}^\rma
\right)
+i\xi_{nm}^\rma(\calc^\ell_{mm}-\calc^\ell_{nn})
\nonumber\\
&=
i\sum_{q\ne nm}
\left(
r_{nq}^\rma
\calc^\ell_{qm}
-
\calc^\ell_{nq}
r_{qm}^\rma
\right)
+ir_{nm}^\rma(\calc^\ell_{mm}-\calc^\ell_{nn})
,
\end{align} 
since in every $\xi_{nm}^\rma$, $n\ne m$, thus we replace it by $r^\rma_{nm}$. 
The matrix elements $\calc^\ell_{nm}(\bfk)$ are calculated in Appendix~\ref{calpcalc}. 

For the general
case of
\begin{align}\label{a.8}
\bra{n\bfk}
\left[\hat r^\rma,\hat\calg(\bfr,\bfp)\right]
\ket{m\bfk'}
&=
\calu_{nm}(\bfk)
,
\end{align}
above result would lead to a more general expression, 
\begin{align}\label{a.9}
(\calg_{nm}(\bfk))_{;k^\rma}
&=
\calu_{nm}(\bfk)
+
i\sum_{q\ne(nm)}
\left(
r_{nq}^\rma (\bfk)
\calg_{qm}(\bfk)
-
\calg_{nq}(\bfk)
r_{qm}^\rma (\bfk)
\right)
+ir_{nm}^\rma (\bfk) (\calg_{mm}(\bfk)-\calg_{nn}(\bfk))
,
\nonumber\\
\end{align}
notice that the last term is zero for $n=m$.
